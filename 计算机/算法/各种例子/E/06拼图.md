```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<script>

    function startMove(ele, json, fn) {
        clearInterval(ele.timer)
        ele.timer = setInterval(() => {
            let bStop = true;
            for (let attr in json) {
                let iCur = 0;
                if (attr == 'opacity')
                    iCur = Math.round(parseFloat(getComputedStyle(ele, false)[attr] * 100));
                else
                    iCur = parseInt(getComputedStyle(ele, false)[attr])
                let speed = (json[attr] - iCur) / 12
                speed = speed > 0 ? Math.ceil(speed) : Math.floor(speed)
                if (json[attr] != iCur)
                    bStop = false
                if ('opacity' == attr)
                    ele.style[attr] = (speed + iCur) / 100
                else
                    ele.style[attr] = iCur + speed + 'px'
            }
            if (bStop) {
                clearInterval(ele.timer)
                if (fn)
                    fn.call(ele)
            }
        }, 16)
    }
</script>
<style>
    * {
        padding: 0;
        margin: 0;
    }

    .clearfix:after {
        content: '';
        clear: both;
        display: block;
    }

    .map-wrap {
        position: relative;
        width: 300px;
        height: 300px;
    }

    .map-wrap div {
        position: absolute;
        width: 100px;
        height: 100px;
        border: 1px solid #ccc;
        box-sizing: border-box;
    }
</style>

<body>
    <div class="map-wrap" style="margin:100px auto;">
        <section class="mask" style="width:300px;height:300px;position:absolute;left:0;top:0;z-index:99999"></section>
</div>
    <script>
        function createMap(parent, row, col) {
            parent.style.width = col * 100 + 'px'
            let seq = 0
            for (let i = 0; i < row; i++) {
                for (let j = 0; j < col; j++) {
                    let oDiv = document.createElement("div")
                    oDiv.index = j + '' + i
                    oDiv.style.backgroundImage = "url('./1.jpg')"
                    oDiv.style.backgroundSize = "300px 300px"
                    oDiv.style.backgroundPosition = `${-j * 100}px ${-i * 100}px`
                    oDiv.style.backgroundRepeat = "no-repeat"
                    oDiv.style.left = j * 100 + 'px'
                    oDiv.style.top = i * 100 + 'px'
                    oDiv.seq = seq++
                    parent.appendChild(oDiv)
                }
            }
        }
        createMap(document.querySelector(".map-wrap"), 3, 3)
        dragLimit(document.querySelector(".map-wrap"), document.querySelectorAll(".map-wrap>div"))
        setTimeout(()=>{
            initLayer(document.querySelectorAll(".map-wrap>div"))
        },1000);
        function dragLimit(wrap, objArr) {
            let borderLeft = wrap.offsetLeft
            let borderTop = wrap.offsetTop
            let borderW = wrap.offsetWidth;
            let borderH = wrap.offsetHeight;

            for (let i = 0; i < objArr.length; i++) {
                objArr[i].onmousedown = function (ev) {
                    this.style.zIndex = 999;
                    let offsetX = ev.clientX - this.offsetLeft - borderLeft;
                    let offsetY = ev.clientY - this.offsetTop - borderTop;
                    switchBtn =false;
                    document.onmousemove = function (ev) {
                        ev.preventDefault()
                        let l = ev.clientX - offsetX
                        let t = ev.clientY - offsetY
                        if (l < borderLeft) {
                            l = borderLeft
                        }
                        if (t < borderTop) {
                            t = borderTop
                        }
                        if (l > borderLeft + borderW - objArr[i].offsetWidth) {
                            l = borderLeft + borderW - objArr[i].offsetWidth
                        }
                        if (t > borderTop + borderH - objArr[i].offsetHeight) {
                            t = borderTop + borderH - objArr[i].offsetHeight
                        }
                        objArr[i].style.left = l - borderLeft + 'px'
                        objArr[i].style.top = t - borderTop + 'px'
                        document.onmouseup=function(ev){
                        document.onmousemove = null
                        objArr[i].onmouseup(ev)
                    }
                    objArr[i].onmouseup = function (ev) {
                        ev.stopPropagation()
                        this.style.zIndex = 10
                        let l = Math.round(this.offsetLeft / 100)
                        let t = Math.round(this.offsetTop / 100)
                        startMove(this, {
                            left: l * 100,
                            top: t * 100
                        })
                        for (let i = 0; i < objArr.length; i++) {
                            if (objArr[i].index == l.toString() + t.toString()) {
                                startMove(objArr[i], {
                                    left: this.index[0] * 100,
                                    top: this.index[1] * 100
                                },()=>{
                                    console.log(132)
                                    
                                    var index=0;
                                    for(var j=0;j<objArr.length;j++){
                                        if(objArr[j].seq==j){
                                            index++
                                            continue
                                        }
                                    }
                                    if(index==objArr.length) {
                                        console.log('成功')
                                    }

                                })
                                let tmp2=null
                                    tmp2=this.seq
                                    this.seq=objArr[i].seq
                                    objArr[i].seq=tmp2
                                let tmp = objArr[i].index
                                objArr[i].index = this.index
                                this.index = tmp;
                                break;
                            }
                        }

                        document.onmousemove = null
                        return false
                    }
                    }
                }
            }

        }
        function initLayer(objArr) {
            for (let i = 0; i < 30; i++) {
                let num1 = ran(0, objArr.length - 1)
                let num2 = ran(0, objArr.length - 1)
                let tmp = objArr[num1].index
                let tmp2=objArr[num1].seq
                objArr[num1].index = objArr[num2].index
                objArr[num1].seq = objArr[num2].seq
                objArr[num2].index = tmp
                objArr[num2].seq = tmp2
                initMove(objArr)
            }
        }
        function ran(min, max) {
            return Math.floor(Math.random() * min + (max - min) * Math.random())
        }
        function initMove(objArr) {
            let flag = objArr.length
            let flag2=objArr.length

            for (let i = 0; i < objArr.length; i++) {
                let left = ran(0, 200)
                let top = ran(0, 200)
                startMove(objArr[i], {
                    left, top
                }, function () {
                    flag--
                })
            }
            let timer = setInterval(() => {
                if (flag == 0) {
                    for (let i = 0; i < objArr.length; i++) {
                        let left = objArr[i].index[0]*100
                        let top = objArr[i].index[1]*100
                        startMove(objArr[i], {
                            left, top
                        }, function () {
                            flag2--
                        })
                    }
                    clearInterval(timer)
                }
            }, 100)
            let timer2=setInterval(()=>{
                if(flag2==0){
                    document.querySelector('.mask').style.display="none";
                    clearInterval(timer2)
                }
            },100)
        }
    </script>
</body>

</html>
```